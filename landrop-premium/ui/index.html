<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>LANDrop Air</title>

<style>

/* ===== BACKGROUND ===== */
body{
  margin:0;
  background:radial-gradient(circle,#1f2937,#020617);
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  color:white;
  height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
}

/* ===== PANEL ===== */
.panel{
  text-align:center;
  padding:40px;
  border-radius:28px;
  background:rgba(255,255,255,0.05);
  backdrop-filter:blur(30px);
  box-shadow:0 30px 80px rgba(0,0,0,0.7);
}

h1{ margin-bottom:20px; }

/* ===== RADAR ===== */
.radar{
  position:relative;
  width:320px;
  height:320px;
  margin:auto;
  border-radius:50%;
}

.ring{
  position:absolute;
  border-radius:50%;
  border:2px solid rgba(59,130,246,0.4);
  animation:expand 3s infinite;
}
.ring:nth-child(1){width:120px;height:120px;top:100px;left:100px;}
.ring:nth-child(2){width:200px;height:200px;top:60px;left:60px;animation-delay:1s;}
.ring:nth-child(3){width:280px;height:280px;top:20px;left:20px;animation-delay:2s;}

@keyframes expand{
  0%{opacity:.8;transform:scale(.8);}
  100%{opacity:0;transform:scale(1.1);}
}

.center{
  position:absolute;
  top:50%; left:50%;
  transform:translate(-50%,-50%);
  font-size:42px;
}

/* ===== DEVICE BUBBLE ===== */
.device{
  position:absolute;
  width:90px;
  height:90px;
  border-radius:50%;
  background:rgba(255,255,255,.08);
  backdrop-filter:blur(15px);
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  transition:.25s;
}
.device:hover{
  transform:scale(1.15);
  background:rgba(59,130,246,.35);
}

button{
  margin-top:20px;
  background:linear-gradient(135deg,#60a5fa,#3b82f6);
  border:none;
  padding:12px 26px;
  border-radius:10px;
  color:white;
  cursor:pointer;
}

.popup{
  position:fixed;
  bottom:40px;
  background:rgba(0,0,0,.7);
  padding:18px 26px;
  border-radius:14px;
  backdrop-filter:blur(15px);
}

/* ===== CHAT ===== */
#chatBox{
  height:260px;
  width:360px;
  overflow:auto;
  background:rgba(0,0,0,.4);
  padding:12px;
  border-radius:12px;
  margin-bottom:12px;
  text-align:left;
}

.chat-input{
  padding:10px;
  width:70%;
  border-radius:8px;
  border:none;
}

.secure{
  margin-top:10px;
  font-size:13px;
  opacity:.8;
}

</style>
</head>

<body>

<!-- ========= CONNECT SCREEN ========= -->
<div id="connectScreen" class="panel">

<h1>LANDrop Air</h1>

<div class="radar">
<div class="ring"></div>
<div class="ring"></div>
<div class="ring"></div>
<div class="center">ðŸ“¡</div>
<div id="devices"></div>
</div>

<button onclick="scan()">Scan Devices</button>

<div class="secure">ðŸ”’ End-to-End Encrypted</div>

</div>

<!-- ========= CHAT SCREEN ========= -->
<div id="chatScreen" class="panel" style="display:none">

<h2>ðŸ’¬ Connected</h2>

<div id="chatBox"></div>

<input id="chatInput" class="chat-input"
       placeholder="Type message">
<button onclick="sendMsg()">Send</button>

</div>

<div id="popup"></div>

<script>
const { exec } = require("child_process");

let selectedDevice = null;
const popup = document.getElementById("popup");

window.onload = () => setTimeout(scan, 800);

/* ===== DEVICE SCAN ===== */
function scan(){

  exec("py engine/discovery_client.py",(err,out)=>{

    const container = document.getElementById("devices");
    container.innerHTML = "";

    let angle = 0;

    out.split("\n").forEach(line=>{

      if(!line) return;

      const [name,ip] = line.split("|");

      const r = 130;
      const x = 160 + r*Math.cos(angle);
      const y = 160 + r*Math.sin(angle);
      angle += 1.2;

      const d = document.createElement("div");
      d.className = "device";
      d.style.left = x + "px";
      d.style.top  = y + "px";
      d.innerHTML = `ðŸ’»<div>${name}</div>`;

      d.onclick = ()=>requestPair(name,ip);

      container.appendChild(d);
    });
  });
}

/* ===== PAIR REQUEST ===== */
function requestPair(name,ip){

  selectedDevice = {name,ip};

  popup.innerHTML = `
    <div class="popup">
      Connect to ${name}?<br>
      <button onclick="accept()">Accept</button>
      <button onclick="reject()">Reject</button>
    </div>`;
}

/* ===== ACCEPT CONNECTION ===== */
function accept(){

  showPopup(`âœ… Connected to ${selectedDevice.name}`);

  // send CONNECTED signal
  exec(`py engine/sender.py "${selectedDevice.ip}" "MSG:CONNECTED"`);

  setTimeout(openChat,1200);
}

function reject(){ popup.innerHTML=""; }

/* ===== SWITCH TO CHAT ===== */
function openChat(){

  document.getElementById("connectScreen").style.display="none";
  document.getElementById("chatScreen").style.display="block";
}

/* ===== SEND MESSAGE ===== */
function sendMsg(){

  if(!selectedDevice) return;

  const text = document.getElementById("chatInput").value;

  exec(`py engine/sender.py "${selectedDevice.ip}" "MSG:${text}"`);

  const box = document.getElementById("chatBox");
  box.innerHTML += `<div>ðŸŸ¢ You: ${text}</div>`;

  document.getElementById("chatInput").value="";
}

/* ===== POPUP ===== */
function showPopup(msg){

  popup.innerHTML = `<div class="popup">${msg}</div>`;
  setTimeout(()=>popup.innerHTML="",2000);
}
</script>

</body>
</html>