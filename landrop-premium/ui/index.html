<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>LANDrop Air</title>

<style>

/* ===== BACKGROUND ===== */
body{
  margin:0;
  background:radial-gradient(circle,#1f2937,#020617);
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  color:white;
  height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
}

/* ===== PANEL ===== */
.panel{
  text-align:center;
  padding:40px;
  border-radius:28px;
  background:rgba(255,255,255,0.05);
  backdrop-filter:blur(30px);
  box-shadow:0 30px 80px rgba(0,0,0,0.7);
}

h1{ margin-bottom:20px; }

/* ===== RADAR ===== */
.radar{
  position:relative;
  width:320px;
  height:320px;
  margin:auto;
  border-radius:50%;
}

/* Radar rings */
.ring{
  position:absolute;
  border-radius:50%;
  border:2px solid rgba(59,130,246,0.4);
  animation:expand 3s infinite;
}
.ring:nth-child(1){width:120px;height:120px;top:100px;left:100px;}
.ring:nth-child(2){width:200px;height:200px;top:60px;left:60px;animation-delay:1s;}
.ring:nth-child(3){width:280px;height:280px;top:20px;left:20px;animation-delay:2s;}

@keyframes expand{
  0%{opacity:.8;transform:scale(.8);}
  100%{opacity:0;transform:scale(1.1);}
}

.center{
  position:absolute;
  top:50%; left:50%;
  transform:translate(-50%,-50%);
  font-size:42px;
}

/* ===== DEVICE BUBBLE ===== */
.device{
  position:absolute;
  width:90px;
  height:90px;
  border-radius:50%;
  background:rgba(255,255,255,.08);
  backdrop-filter:blur(15px);
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  transition:.25s;
}
.device:hover{
  transform:scale(1.15);
  background:rgba(59,130,246,.35);
}
.name{font-size:12px;margin-top:4px}

/* ===== BUTTON ===== */
button{
  margin-top:20px;
  background:linear-gradient(135deg,#60a5fa,#3b82f6);
  border:none;
  padding:12px 26px;
  border-radius:10px;
  color:white;
  cursor:pointer;
}

/* ===== POPUP ===== */
.popup{
  position:fixed;
  bottom:40px;
  background:rgba(0,0,0,.7);
  padding:18px 26px;
  border-radius:14px;
  backdrop-filter:blur(15px);
}

/* ===== TRANSFER UI ===== */
.transfer{
  margin-top:15px;
}

.ring-progress{
  width:120px;
  height:120px;
  border-radius:50%;
  border:8px solid rgba(255,255,255,.1);
  border-top:8px solid #3b82f6;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:20px;
  animation:spin 1s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg)}}

/* ===== CHAT ===== */
.chat{ margin-top:15px }
.chat input{
  padding:8px;
  border-radius:8px;
  border:none;
  width:180px;
}
.chat button{ padding:8px 16px }

/* ===== BADGES ===== */
.secure{
  margin-top:10px;
  font-size:13px;
  opacity:.8;
}

</style>
</head>

<body>

<div class="panel">

<h1>LANDrop Air</h1>

<div class="radar">

<div class="ring"></div>
<div class="ring"></div>
<div class="ring"></div>

<div class="center">ðŸ“¡</div>

<div id="devices"></div>

</div>

<button onclick="scan()">Scan Devices</button>

<div class="secure">ðŸ”’ End-to-End Encrypted</div>

<!-- Transfer UI -->
<div id="transferUI" class="transfer" style="display:none">
  <div class="ring-progress">
    <span id="percent">0%</span>
  </div>
  <div id="speed"></div>
</div>

<!-- Chat -->
<div class="chat">
  <input id="msg" placeholder="Message">
  <button onclick="sendMsg()">Send</button>
</div>

</div>

<div id="popup"></div>

<script>
const { exec } = require("child_process");

let selectedDevice = null;
let devices = [];

/* ===== AUTO CONNECT ===== */
window.onload = () => setTimeout(scan, 700);

/* ===== SCAN DEVICES ===== */
function scan(){

  exec("py engine/discovery_client.py",(err,out)=>{

    const container = document.getElementById("devices");
    container.innerHTML="";
    devices=[];

    let angle=0;

    out.split("\n").forEach(line=>{

      if(!line) return;

      const [name,ip]=line.split("|");
      devices.push({name,ip});

      const r=130;
      const x=160+r*Math.cos(angle);
      const y=160+r*Math.sin(angle);
      angle+=1.2;

      const d=document.createElement("div");
      d.className="device";
      d.style.left=x+"px";
      d.style.top=y+"px";
      d.innerHTML=`ðŸ’»<div class="name">${name}</div>`;

      /* CLICK â†’ PAIR */
      d.onclick=()=>requestPair(name,ip);

      /* ðŸ”¥ DRAG TARGET */
      d.ondragover=e=>e.preventDefault();
      d.ondrop=e=>{
        e.preventDefault();
        const file=e.dataTransfer.files[0];
        if(file) sendFile(ip,file.path,name);
      };

      container.appendChild(d);
    });
  });
}

/* ===== PAIR ===== */
function requestPair(name,ip){
  selectedDevice={name,ip};
  popup.innerHTML=`
    <div class="popup">
      ${name} wants to connect<br>
      <button onclick="accept()">Accept</button>
      <button onclick="reject()">Reject</button>
    </div>`;
}

function accept(){
  popup.innerHTML=`
    <div class="popup">âœ… Connected to ${selectedDevice.name}</div>`;
  setTimeout(()=>popup.innerHTML="",2000);
}
function reject(){ popup.innerHTML="" }

/* ===== SEND FILE ===== */
function sendFile(ip,path,name){

  startTransferUI(name);

  exec(`py engine/sender.py ${ip} "${path}"`);
}

/* ===== TRANSFER UI ===== */
function startTransferUI(name){

  const ui=document.getElementById("transferUI");
  const percent=document.getElementById("percent");
  const speed=document.getElementById("speed");

  ui.style.display="block";

  let p=0;

  const interval=setInterval(()=>{

    p+=Math.random()*8;

    if(p>=100){
      p=100;
      clearInterval(interval);
      speed.innerText="Transfer complete";
    }

    percent.innerText=Math.floor(p)+"%";
    speed.innerText=(2+Math.random()*6).toFixed(2)+" MB/s";

  },300);
}

/* ===== CHAT ===== */
function sendMsg(){

  if(!selectedDevice) return;

  const text=document.getElementById("msg").value;

  exec(`py engine/sender.py ${selectedDevice.ip} "MSG:${text}"`);
}

</script>

</body>
</html>